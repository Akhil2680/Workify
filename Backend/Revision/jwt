Perfect bhai ğŸ‘
Ab main **JWT + Register + Login ka COMPLETE FLOW** firse samjha raha hoon â€”
**Database se leke Server, Routes, Controllers, Middleware**
ğŸ‘‰ **file by file, request by request**
ğŸ‘‰ aise samjho jaise **whiteboard pe explain ho raha ho**

---

# ğŸ”¥ BIG PICTURE (1 line)

> **Register â†’ DB me user save**
> **Login â†’ password check â†’ JWT generate**
> **Protected route â†’ JWT verify â†’ access allow**

Ab isko **andar se tod ke** samajhte hain.

---

# ğŸ“ PROJECT STRUCTURE (AUTH RELATED)

```
src/
â”‚
â”œâ”€â”€ app.js
â”œâ”€â”€ server.js
â”‚
â”œâ”€â”€ routes/
â”‚   â””â”€â”€ authRoutes.js
â”‚
â”œâ”€â”€ controllers/
â”‚   â””â”€â”€ authController.js
â”‚
â”œâ”€â”€ middlewares/
â”‚   â”œâ”€â”€ authMiddleware.js
â”‚   â”œâ”€â”€ errorHandler.js
â”‚   â””â”€â”€ notFound.js
â”‚
â”œâ”€â”€ config/
â”‚   â””â”€â”€ db.js
â”‚
â””â”€â”€ .env
```

---

# ğŸ—„ï¸ DATABASE (MySQL)

### users table

```sql
id | name | email | password | role | created_at
```

âš ï¸ `password` **hashed hota hai**, plain kabhi nahi

---

# ğŸŸ¢ PART 1: REGISTER FLOW (STEP BY STEP)

## ğŸ” Request

```
POST /api/auth/register
```

Body:

```json
{
  "name": "Akhil",
  "email": "akhil@gmail.com",
  "password": "123456",
  "role": "client"
}
```

---

## 1ï¸âƒ£ app.js (ENTRY POINT)

```js
app.use(express.json());
app.use('/api/auth', authRoutes);
```

ğŸ‘‰ Express JSON body read karta
ğŸ‘‰ Request `/api/auth/register` â†’ `authRoutes.js`

---

## 2ï¸âƒ£ authRoutes.js (ROUTING)

```js
router.post('/register', registerUser);
```

ğŸ‘‰ Express bole:

> â€œIs route ke liye controller chalaoâ€

---

## 3ï¸âƒ£ authController.js (REGISTER LOGIC)

### a) Data extract

```js
const { name, email, password, role } = req.body;
```

---

### b) Validation

```js
if (!name || !email || !password || !role)
```

---

### c) Email already exists?

```js
SELECT * FROM users WHERE email = ?
```

Agar mila â†’ âŒ error

---

### d) Password hash

```js
bcrypt.hash(password, 10);
```

Plain password âŒ
Hash âœ…

---

### e) DB insert

```js
INSERT INTO users (...)
```

---

### f) Response

```json
201 Created
User registered successfully
```

âœ… **REGISTER DONE**

---

# ğŸ”µ PART 2: LOGIN FLOW (STEP BY STEP)

## ğŸ” Request

```
POST /api/auth/login
```

Body:

```json
{
  "email": "akhil@gmail.com",
  "password": "123456"
}
```

---

## 1ï¸âƒ£ app.js â†’ authRoutes.js

```js
router.post('/login', loginUser);
```

---

## 2ï¸âƒ£ authController.js (LOGIN LOGIC)

### a) Email check

```js
SELECT * FROM users WHERE email = ?
```

Agar nahi mila â†’ âŒ error

---

### b) Password match

```js
bcrypt.compare(inputPassword, hashedPassword);
```

* Match âŒ â†’ error
* Match âœ… â†’ next step

---

### c) JWT generate (IMPORTANT)

```js
jwt.sign(
  { id: user.id },
  process.env.JWT_SECRET,
  { expiresIn: '1d' }
);
```

ğŸ‘‰ JWT = **signed identity card**

---

### d) Response

```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6..."
}
```

âœ… **LOGIN DONE**

---

# ğŸ” PART 3: PROTECTED ROUTE FLOW (JWT VERIFY)

## ğŸ” Request

```
GET /api/protected
```

Headers:

```
Authorization: Bearer <JWT_TOKEN>
```

---

## 1ï¸âƒ£ app.js

```js
app.get('/api/protected', protect, controller);
```

ğŸ‘‰ `protect` middleware pehle chalega

---

## 2ï¸âƒ£ authMiddleware.js (GATEKEEPER)

### a) Token extract

```js
req.headers.authorization
```

---

### b) Token verify

```js
jwt.verify(token, JWT_SECRET);
```

* Invalid âŒ â†’ error
* Valid âœ… â†’ decoded payload

---

### c) Attach user

```js
req.user = decoded;
```

---

### d) next()

ğŸ‘‰ Request controller tak jaati hai

---

## 3ï¸âƒ£ Controller (Protected logic)

```js
res.json({
  message: 'You are authorized',
  user: req.user
});
```

âœ… **ACCESS GRANTED**

---

# ğŸ§  IMPORTANT MENTAL MODEL (YAAD RAKH)

```
Register â†’ DB
Login â†’ JWT
JWT â†’ Header
Header â†’ Middleware
Middleware â†’ req.user
```

---

# ğŸ¯ INTERVIEW ONE-LINER

> â€œJWT is generated during login and verified by middleware to protect routes.â€

---

# ğŸ FINAL STATUS

| Feature         | Status |
| --------------- | ------ |
| Register        | âœ…      |
| Login           | âœ…      |
| JWT Generate    | âœ…      |
| JWT Verify      | âœ…      |
| Protected Route | âœ…      |

---

## ğŸ”¥ NEXT?

Now you are ready for **REAL FEATURES**:

* Role-based access (client / worker)
* Worker profile APIs
* Booking system

Just tell me:

> **â€œStart role based accessâ€**
> or
> **â€œStart worker APIsâ€**

Tu ab **proper backend dev** ban chuka hai bhai ğŸ‘‘ğŸ”¥
